# Route

[PATH_INFO](0.1-pathinfo.md)和[AutoLoad](0.1.1-autoload.md)两节的介绍，我们大概对URL如何定位到某个PHP代码的基础原理有了一定的知识准备。这里，我准备开始我们的路由管理器的正式编码过程。

PHP的动态语言特性
---

在开始之前，我还需要给大家演示一下PHP的动态语言特性：

```php
class Abc {

}

$clsname = 'Abc'; //注意这里是一个字符串
$abc = new $clsname; //注意这里new一个字符串，注意这段代码不会报错
```

看到没有，我们可以直接new一个字符串，从而实例化一个以字符串为类名的对象。这其实跟很多其他语言里面的反射非常类似，只不过PHP因为其动态语言特性，在语法上显得更简单。

URL的基础
--

我们知道，一个URL的格式大概类似这样：`http://hostname.domain/mname/cname/aname?querystr`。而发起一个HTTP请求的本质是，向服务器请求某个URL对应的资源文件。

通过Url重写和PHP-PATH_INFO技术，这个资源文件的请求可以重定向到PHP，并请求到一个不在web根目录的资源。所以，我们可以把一个URL请求`http://hostname.domain/mname/cname/aname?querystr`通过服务器端的技术处理，实际发送到`http://hostname.domain/index.php`，而`/mname/cname/aname?querystr`中的`/mname/cname/aname`部分会作为PATH_INFO传输给`index.php`而`?querystr`会作为QUERY_STR传输给`index.php`，所以我们请求任何地址，最终是传递不同的请求参数到`index.php`。

那么，我们可以在`index.php`里面根据不同的参数规则去加载运行不同的PHP代码文件。这其实就是很多PHP-MVC框架路由请求部分最基本的原理了。

路由规则约定
---

在开始路由解析模块编码之前，我们先定义一些路由规则约定：

* 默认控制器方法名为`index`，即在未指定控制器方法时，默认调用控制器的`index`方法。
* 默认控制器名为`index`，即在未指定控制器名时，默认调用`index`控制器的`index`方法。
* 请求PATH_INFO的最后一个`/`和倒数第二个`/`之间的部分为**控制器名**，控制器名之前的部分为控制器路径，之后的部分为方法名。

示例：

* `/` 请求默认的`index`控制器的`index`方法。
* `/abc` 请求`abc`控制器的`index`方法。
* `/abc/d` 请求`abc`控制器的`d`方法。
* `/abc/d/` 请求`abc/d`控制器的`index`方法，注意和上一条的不同，`abc`为控制器路径，`d`为控制器名
* `/abc/d/e` 请求`abc/d`控制器`e`方法

目录结构
---

	php-mvc/
		|- taglogs/ 实验记录
		|- websrc/	源代码目录
			|- core/ 核心框架目录
			|- ext/ 第三方扩展目录
			|- src/ 站点代码目录
				|- ctrls/ 控制器代码文件目录
			|- web/ web根目录
				|- index.php 启动脚本


代码文件 & 命名空间约定
--

* 代码文件名、路径严格区分大小写。
* 一个控制器类一个代码文件。
* 控制器类名首字母大写，类名和文件名严格一致。
* 命名空间遵循PSR-4规范
* `\web` 命名空间的基址为`php-mvc/websrc/src`
* `\core` 命名空间的基址为`php-mvc/websrc/core`

> `代码文件名、路径严格区分`大小写非常重要，因为Windows下面，路径不区分大小写，而Linux是区分大小写。大多数人的开发环境为Windows系统，如果我们不注意这点，可能导致开发没有问题，部署的时候大量的类找不到错误。